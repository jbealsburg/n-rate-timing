<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-03-22">

<title>N-rate Timing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="nrate_draft_files/libs/clipboard/clipboard.min.js"></script>
<script src="nrate_draft_files/libs/quarto-html/quarto.js"></script>
<script src="nrate_draft_files/libs/quarto-html/popper.min.js"></script>
<script src="nrate_draft_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nrate_draft_files/libs/quarto-html/anchor.min.js"></script>
<link href="nrate_draft_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nrate_draft_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nrate_draft_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nrate_draft_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nrate_draft_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">N-rate Timing</h1>
<p class="subtitle lead">first draft</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="key-points" class="level1">
<h1>Key points</h1>
<ul>
<li><p>We applied N at different rates and timings to IWG stands over 10 site-years</p></li>
<li><p>We observed serious lodging in only 1 site-year, and observed lower lodging when N was applied at lower rates and further away from harvest (i.e.&nbsp;fall vs.&nbsp;spring or summer). Lodging was negatively correlated with plant height (<span class="math inline">\(r=-0.5\)</span>)</p></li>
<li><p>For both cumulative and yearly yield response to nitrogen rate, a quadratic relationship fit the data best, suggesting there is an optimal N rate.</p></li>
<li><p>Combined across all site-years, yields were higher when N was applied in the fall versus in the spring or when split with a summer application.</p></li>
<li><p>Of sites where we tracked yield over three years, we failed to reject the Ho that N rate and timing had no impact on the yield of the stand.</p></li>
<li><p>The relationship between N rate and timing is complex to measure in field experiments. Site conditions can greatly change the amount of N that becomes available to the plant, especially when applied as urea on the soil surface. More research is required to capture the variability of yield response to N rate and timing.</p></li>
<li><p>The optimal fertility program is likely site specific.</p></li>
</ul>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<div class="cell">

</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>Our dataset is unbalanced because design was not consistent across sites. First we try to see a consistent response across site-years, then we may analyze each site seperately.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Ee have 10 site-years, more than enough to be a random effect</caption>
<thead>
<tr class="header">
<th style="text-align: left;">location</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NDSU</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">NDSU</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R100</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">R100</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Staples</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">Staples</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Staples</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">V17</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V17</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">V17</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="lodging" class="level1">
<h1>Lodging</h1>
<p>Understanding lodging is not a primary objective of this experiment, this data was only collected as a covariate if there happened to be a lot of lodging.</p>
<p>In general, if lodging is above 6, the yield data is questionable.</p>
<p>Only R100 and V17 showed lodging, and only R100 had severe lodging to the point where the yield data probably is not very accurate.</p>
<section id="r100" class="level2">
<h2 class="anchored" data-anchor-id="r100">R100</h2>
<p>R100 only had N applied in the second and third year.</p>
<p>Lodging only occurred in the stands third year of production.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We observe a general increase in lodging as nitrogen rate increases. We fit a logistic curve since lodging cannot be greater than 10 and we expect as we increase N rate more lodging will get closer to 10. This curve is obviously not perfect.</p>
<!-- Looking at treatment timing with N rate, I see a bit more red dots (fall) with lower lodging, but it's messy. Sprint split has some of the most lodging, but also an outlier at near 150 kg N ha where there was no lodging -->
<div class="cell">
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we are fitting a logistic regression with a y intercept of zero because we assume at 0N there is no lodging (as shown with control plots) and that lodging score will increase as nitrogen rate increases but that lodging will never exceed 10. The takeaway from this figure is that there is no lodging at 0N and that you see less lodging when you apply in fall and more when you apply in spring and summer.</p>
<section id="analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: lodging
                        Df  Sum Sq Mean Sq  F value Pr(&gt;F)    
log(n.total + 1)         1 3109.08 3109.08 428.8900 &lt;2e-16 ***
timing                   5   19.87    3.97   0.5481 0.7388    
log(n.total + 1):timing  3   18.84    6.28   0.8664 0.4655    
Residuals               45  326.21    7.25                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We reject Ho that the rate of nitrogen does not impact lodging.</p>
<p>We fail to reject Ho that timing has an impact on lodging.</p>
</section>
</section>
</section>
<section id="plant-height" class="level1">
<h1>Plant height</h1>
<p>Plant height is also not a measurement of primary interest.</p>
<p>To what extent does plant height relate to lodging in R100?</p>
<section id="r100-year-3" class="level2">
<h2 class="anchored" data-anchor-id="r100-year-3">R100 year 3</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We observe an overall trend of decreasing plant height as N rate increases, modeled best quadratically.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: height
                 Df   Sum Sq   Mean Sq F value   Pr(&gt;F)   
poly(n.total, 2)  2 0.050934 0.0254669  5.4217 0.007609 **
timing            4 0.035753 0.0089383  1.9029 0.125627   
Residuals        47 0.220770 0.0046972                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We reject Ho that nrate does not impact height</p>
<p>We fail to reject Ho that timing has no effect on plant height</p>
<p>We have learned from R100 in it’s third stand age that as nrate increases, there is an increase in lodging and a decrease in plant height. To what extent are they correlated?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           lodging     height
lodging  1.0000000 -0.4993655
height  -0.4993655  1.0000000</code></pre>
</div>
</div>
<p>We observe a pearson correlation coefficient of -0.5 between height and lodging. This is considered between a moderate and strong correlation.</p>
</section>
</section>
<section id="yield" class="level1">
<h1>Yield</h1>
<section id="cumulative" class="level2">
<h2 class="anchored" data-anchor-id="cumulative">cumulative</h2>
<p>Cumulative yield of kernza stands after 3 years of N fertilizer. We are subsetting dataset, Only V17 and Staples meet this criteria (6 site years). We sum across stand.age to create a cumulative yield and a cumulative amount of N applied, then divide both values by 3 to get a yearly yield~N response.</p>
<section id="quadratic-linear-model-yield-response-to-n" class="level3">
<h3 class="anchored" data-anchor-id="quadratic-linear-model-yield-response-to-n">quadratic linear model, yield response to N</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1020.782</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000.713</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: yield.cum
              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
poly(cumn, 2)  2 2696949 1348475  12.438 2.607e-05 ***
Residuals     66 7155387  108415                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We reject the Ho that N rate does not impact yield</p>
<p>Quadratic model provides the best fit</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: yield.cum
                       Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
poly(cumn, 2)           2 2011131 1005565 12.0239 0.0001701 ***
location                1 2181936 2181936 26.0901 2.065e-05 ***
timing                  2  284394  142197  1.7003 0.2009473    
poly(cumn, 2):location  2  114253   57126  0.6831 0.5132778    
poly(cumn, 2):timing    3  186149   62050  0.7419 0.5360498    
location:timing         2   71804   35902  0.4293 0.6551831    
Residuals              28 2341662   83631                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We fail to reject the Ho that timing does not impact yield</p>
</section>
<section id="quadratic-linear-mixed-effect-model" class="level3">
<h3 class="anchored" data-anchor-id="quadratic-linear-mixed-effect-model">quadratic linear mixed effect model</h3>
<p>Here we have our fixed effect of cumulative N, timing and a random effect of block. Since we only have two sites, location is treated as a fixed effect.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: yield.cum
                                Chisq Df Pr(&gt;Chisq)    
poly(cumn, 2)                  0.5868  2     0.7457    
timing                         4.0312  2     0.1332    
location                      27.2054  1  1.829e-07 ***
poly(cumn, 2):timing           2.8742  3     0.4114    
poly(cumn, 2):location         1.1353  2     0.5669    
timing:location                0.8907  2     0.6406    
poly(cumn, 2):timing:location          0               
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We fail to reject Ho that yield does not differ N rate or timing</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TAKEAWAY: We applied N at differing rates and timings over 3 years at two locations. We cannot reject the Ho that the amount of N and the timing of N do not impact the cumulative yield over the 3 years when modelled as a fixed effect model. Personally, I would say our data suggests at around 60 kg N ha per year results in best grain yields and then adding more N has no effect. When modeled as a simple quadratic linear model, we can make this conclusion, but when modelled as a mixed effect model we cannot.</p>
</section>
</section>
<section id="yearly-performance" class="level2">
<h2 class="anchored" data-anchor-id="yearly-performance">Yearly performance</h2>
<p>We are using all site years except third stand age of R100 due to high lodging.</p>
<p>How does N timing and N amount correlate with yield in a given year?</p>
<section id="full-model-site-years-as-random" class="level3">
<h3 class="anchored" data-anchor-id="full-model-site-years-as-random">full model, site-years as random</h3>
<p>We reject Ho that stand.age, timing and nitrogen rate do not impact yield</p>
<p>Here we have subsetted data so we have removed instances where a timing was Fall but no fall N was applied. We only start doing this here because this is the first time we are looking at timing across years at each year.</p>
<section id="nitrogen-rate-on-yield" class="level4">
<h4 class="anchored" data-anchor-id="nitrogen-rate-on-yield">nitrogen rate on yield</h4>
<div class="cell">
<div class="cell-output-display">
<p><img src="nrate_draft_files/figure-html/nrate%20effect-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We previously learned the relationship between N rate and yield is best modelled quadratically and then we rejected Ho that nitrogen rate does not impact yield. Here we are visualizing the subsetted data used in the model.</p>
</section>
<section id="timing-on-yield" class="level4">
<h4 class="anchored" data-anchor-id="timing-on-yield">timing on yield</h4>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Estimated marginal means across N rate timings from a mixed effect model of yield as a function of nitrogen rate, timing and stand.age across 9 site-years. No interactions were detected among nitrogen rate, timing and stand age, but main effects were detected from timing</caption>
<thead>
<tr class="header">
<th style="text-align: left;">timing</th>
<th style="text-align: left;">emmean</th>
<th style="text-align: left;">CI</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fall</td>
<td style="text-align: left;">610 a</td>
<td style="text-align: left;">246-975</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="even">
<td style="text-align: left;">Control</td>
<td style="text-align: left;">570 ab</td>
<td style="text-align: left;">229-912</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fall-Spring Split</td>
<td style="text-align: left;">507 ab</td>
<td style="text-align: left;">156-858</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fall-Summer Split</td>
<td style="text-align: left;">505 b</td>
<td style="text-align: left;">141-870</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spring</td>
<td style="text-align: left;">456 b</td>
<td style="text-align: left;">83-828</td>
<td style="text-align: right;">96</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spring-Summer Split</td>
<td style="text-align: left;">420 b</td>
<td style="text-align: left;">54-785</td>
<td style="text-align: right;">48</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We reject the Ho that yields were the same regardless of timing. Applying in the fall was estimated to have a higher grain yield than when split in the spring, summer or applied alone in the spring.</p>
<p>Since the dataset is unbalanced, we reported estimated marginal means, 95% confidence intervals and the number of data points within each timing used in the model.</p>
</section>
</section>
<section id="full-model-location-as-fixed-effect" class="level3">
<h3 class="anchored" data-anchor-id="full-model-location-as-fixed-effect">full model, location as fixed effect</h3>
<p>We have 4 locations and there is a rationale to model them as fixed effects. This puts a lot of stress on our model by cutting it up by n rate, timing, stand age and location. We end up making a lot of meaningless comparisons and need to reduce the comparisons we make in order to prevent a rank deficient model.</p>
<p>We ran a full factorial model, then would remove interaction terms that were insignificant and rerun the model.</p>
<p>we removed R100 from the dataset (site years = 8) because it only had one stand age after we removed third stand age for lodging and when stand.age is modelled as a fixed effect the R100 data doesn’t provide any utility to testing those hypotheses</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: yield
                                              Chisq Df Pr(&gt;Chisq)    
poly(n.total, 2)                            10.7538  2   0.004622 ** 
timing                                      36.3076  5  8.243e-07 ***
stand.age                                  425.5273  2  &lt; 2.2e-16 ***
location                                   156.3313  2  &lt; 2.2e-16 ***
poly(n.total, 2):timing                      4.0963  7   0.768623    
poly(n.total, 2):stand.age                   7.5965  4   0.107527    
timing:stand.age                            14.8525  8   0.062079 .  
poly(n.total, 2):location                    2.2606  3   0.520119    
timing:location                              2.4905  2   0.287867    
stand.age:location                          39.9292  3  1.103e-08 ***
poly(n.total, 2):timing:stand.age            2.1166 10   0.995366    
poly(n.total, 2):timing:location                     0               
poly(n.total, 2):stand.age:location          2.0729  4   0.722358    
timing:stand.age:location                    0.3926  2   0.821752    
poly(n.total, 2):timing:stand.age:location           0               
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: yield
                     Chisq Df Pr(&gt;Chisq)    
poly(n.total, 2)    17.991  2   0.000124 ***
timing              32.370  5  5.018e-06 ***
stand.age          390.718  2  &lt; 2.2e-16 ***
location           163.091  2  &lt; 2.2e-16 ***
stand.age:location  76.858  3  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Change in yield over stand.age was different, Staples when down in year 2 and V17 went up. We will need to separate by location or stand age.</p>
<section id="slice-by-stand-age" class="level4">
<h4 class="anchored" data-anchor-id="slice-by-stand-age">slice by stand age</h4>
<p>Slicing by second stand age yielded the only interesting results.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: yield
                                    Chisq Df Pr(&gt;Chisq)    
poly(n.total, 2)                  14.3748  2   0.000756 ***
timing                            30.0587  5  1.436e-05 ***
location                         118.6736  2  &lt; 2.2e-16 ***
poly(n.total, 2):timing            4.1718  6   0.653435    
poly(n.total, 2):location          2.9520  3   0.399092    
timing:location                    0.5350  2   0.765288    
poly(n.total, 2):timing:location           0               
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Estimated marginal means across N rate timings from a mixed effect model of yield in second year kernza stands as a function of nitrogen rate, timing and location. No interactions were detected among nitrogen rate, timing and location, but main effects were detected from timing</caption>
<thead>
<tr class="header">
<th style="text-align: left;">timing</th>
<th style="text-align: left;">emmean</th>
<th style="text-align: left;">CI</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fall</td>
<td style="text-align: left;">768 a</td>
<td style="text-align: left;">677-860</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fall-Summer Split</td>
<td style="text-align: left;">722 ab</td>
<td style="text-align: left;">615-829</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fall-Spring Split</td>
<td style="text-align: left;">670 abc</td>
<td style="text-align: left;">518-821</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Control</td>
<td style="text-align: left;">638 abc</td>
<td style="text-align: left;">346-929</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spring</td>
<td style="text-align: left;">585 bc</td>
<td style="text-align: left;">503-667</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spring-Summer Split</td>
<td style="text-align: left;">520 c</td>
<td style="text-align: left;">413-627</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>TAKEAWAY: across 8 site-years, second year yields were higher when N was applied in the fall versus in the spring or a spring summer split. They were also higher in the Fall summer split compared with the spring summer split</p>
</section>
<section id="slice-by-site" class="level4">
<h4 class="anchored" data-anchor-id="slice-by-site">slice by site</h4>
<p>Lastly, we can slice by site and do an independent analysis for each site. This is what Dominic did and makes a lot of sense.</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>